---
title: "Configuration"
description: "All configuration lives under SearchEngine.config. Reference, ENV mapping, and practical notes."
---

Related: <a href="/projects/search-engine-for-typesense/installation">Installation</a>, <a href="/projects/search-engine-for-typesense/client">Client</a>, <a href="/projects/search-engine-for-typesense/cli">CLI</a>

This engine centralizes all knobs under <code>SearchEngine.config</code>. These values drive the client and relation layers and are hydrated from ENV at boot by the engine initializer.

## Field reference

| Field              | Type                 | Default        | Notes |
|--------------------|----------------------|----------------|-------|
| `host`             | String               | `"localhost"`  | Typesense node host |
| `port`             | Integer              | `8108`         | Typesense node port |
| `protocol`         | String               | `"http"`       | `"http"` or `"https"` |
| `api_key`          | String, nil          | `nil`          | Required for real requests; redacted in logs |
| `timeout_ms`       | Integer              | `3_600_000`    | Total request timeout (ms) |
| `open_timeout_ms`  | Integer              | `1000`         | Connect/open timeout (ms) |
| `retries`          | Hash                 | `{ attempts: 2, backoff: 10.0..60.0 }` | Backoff supports Float or Range (seconds) |
| `logger`           | Logger-like          | Rails logger or stdout | Must respond to `#info/#warn/#error` |
| `default_query_by` | String, nil          | `nil`          | Comma-separated fields for `query_by` default |
| `default_infix`    | String               | `"fallback"`   | Typesense infix option |
| `use_cache`        | Boolean              | `true`         | URL-level option only |
| `cache_ttl_s`      | Integer              | `60`           | URL-level option: TTL seconds -> `cache_ttl` |
| `strict_fields`    | Boolean              | `true` in development/test; else `false` | Parser validates unknown fields when `true`; see <a href="/projects/search-engine-for-typesense/query-dsl#error-reference">Query DSL</a> |
| `multi_search_limit` | Integer            | `50`           | Hard cap on searches per multi-search; validated before network call |

## ENV mapping

Only blank/unset fields are hydrated from ENV during engine boot; explicit initializer values win.

| ENV var                  | Field           |
|--------------------------|-----------------|
| `TYPESENSE_HOST`         | `host`          |
| `TYPESENSE_PORT`         | `port`          |
| `TYPESENSE_PROTOCOL`     | `protocol`      |
| `TYPESENSE_API_KEY`      | `api_key`       |
| `TYPESENSE_STRICT_FIELDS`| `strict_fields` |

## Initializer

Place the following in your host app at `config/initializers/search_engine.rb`:

```ruby
# config/initializers/search_engine.rb
SearchEngine.configure do |c|
  c.host             = ENV.fetch("TYPESENSE_HOST", "localhost")
  c.port             = ENV.fetch("TYPESENSE_PORT", 8108).to_i
  c.protocol         = ENV.fetch("TYPESENSE_PROTOCOL", "http")
  c.api_key          = ENV.fetch("TYPESENSE_API_KEY")
  c.timeout_ms       = 3_600_000
  c.open_timeout_ms  = 1_000
  c.retries          = { attempts: 2, backoff: 10.0..60.0 }
  c.default_query_by = "name, description"
  c.default_infix    = "fallback"
  c.use_cache        = true
  c.cache_ttl_s      = 60
  c.strict_fields    = Rails.env.development? || Rails.env.test?
  c.logger           = Rails.logger
  c.multi_search_limit = 50
end
```

<Info>
  <strong>Note</strong>: <code>ENV.fetch("TYPESENSE_API_KEY")</code> will raise if not set. This is intentional for production/staging. In development you can omit an initializer and rely on defaults/ENV.
</Info>

## URL-level caching knobs

- `use_cache` and `cache_ttl_s` are URL-level options consumed by the client. They should not be included in request bodies.

## Timeouts & retries

- `timeout_ms`: total request timeout (ms). Default is 60 minutes (3_600_000 ms) and maps to `Typesense::Client`'s `connection_timeout_seconds`.
- `open_timeout_ms`: connect/open timeout (ms).
- `retries`: `{ attempts: Integer, backoff: Float or Range<Float> }` where backoff is in seconds.
  - When `backoff` is a Range (e.g., `10.0..60.0`), the client samples a single value at build time to introduce jitter between retries.

Example overrides:

```ruby
SearchEngine.configure do |c|
  # Keep long writes from aborting prematurely
  c.timeout_ms = 3_600_000

  # Introduce jitter to avoid thundering herd on retries
  c.retries = { attempts: 3, backoff: 10.0..60.0 }
end
```

## Logger

Defaults to `Rails.logger` when available; otherwise a `$stdout` logger at INFO level. You may supply any object responding to `#info`, `#warn`, and `#error`.

## Validation & warnings

Calling `SearchEngine.configure { ... }` validates obvious misconfigurations (bad protocol, negative timeouts, etc.). At boot, the engine logs a one-time warning if `api_key` or `default_query_by` are missing; secrets are not printed.

```mermaid
flowchart LR
  A[ENV] -->|hydrate if nil| B[Engine initializer]
  B --> C[SearchEngine.config]
  C --> D[Client & Relations]
```



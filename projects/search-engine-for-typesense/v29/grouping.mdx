---
title: "Grouping"
description: "Group results by a key and cap hits per group. Compiler mapping and result access patterns."
---

Backlinks: <a href="/projects/search-engine-for-typesense/v29/field-selection">Field Selection</a>, <a href="/projects/search-engine-for-typesense/v29/relation">Relation</a>

See example: <code>examples/demo_shop/app/controllers/groups_controller.rb</code>.

- <strong>State source</strong>: <code>Relation#group_by(field, limit: nil, missing_values: false)</code> stores normalized state in <code>@state[:grouping]</code>
- <strong>Compiler</strong>: <code>Relation#to_typesense_params</code> emits Typesense params: <code>group_by</code>, <code>group_limit</code>, <code>group_missing_values</code>

```ruby
rel = SearchEngine::Book.group_by(:author_id, limit: 1, missing_values: true)
# => { q: "*", query_by: "name, description", group_by: "author_id", group_limit: 1, group_missing_values: true }
```

| Call | Params |
| --- | --- |
| <code>.group_by(:author_id)</code> | <code>group_by: "author_id"</code> |
| <code>.group_by(:author_id, limit: 2)</code> | <code>group_by: "author_id"</code>, <code>group_limit: 2</code> |
| <code>.group_by(:author_id, missing_values: true)</code> | <code>group_by: "author_id"</code>, <code>group_missing_values: true</code> |
| <code>.group_by(:author_id, limit: 1, missing_values: true)</code> | <code>group_by: "author_id"</code>, <code>group_limit: 1</code>, <code>group_missing_values: true</code> |

```mermaid
flowchart LR
  A[Relation#group_by] --> B[@state[:grouping]
  C[Compiler] --> D{ group_by, group_limit, group_missing_values }]
```

```ruby
result = SearchEngine::Book.group_by(:author_id, limit: 2).to_a
res = SearchEngine::Book.group_by(:author_id, limit: 2).execute
```

Backlinks: <a href="https://github.com/lstpsche/search-engine-for-typesense#readme" target="_blank">README</a>, <a href="/projects/search-engine-for-typesense/v29/field-selection">Field Selection</a>

```json
{"event":"search","collection":"books","status":200,"duration.ms":12.3,"cache":true,"ttl":60,"group_by":"author_id","group_limit":1,"group_missing_values":true}
```


